wp =[0 0 -1 ; 1 4 -1 ; 1 3 -1 ; 3 3 -1 ; 2 3 -1 ; 2 2 -1 ; 2 1 -1 ; 1 1 -1 ; 1 4 -1 ; 3 2 -1 ; 1 2 -1 ; 1 1 -1 ; 3 1 -1 ; 4 3 -1 ; 0 0 -1 ];
wp(:,:,2) =[0 0 -1 ; 4 3 -1 ; 3 4 -1 ; 4 4 -1 ; 2 4 -1 ; 2 3 -1 ; 3 2 -1 ; 1 4 -1 ; 2 1 -1 ; 4 1 -1 ; 4 2 -1 ; 3 2 -1 ; 1 1 -1 ; 1 3 -1 ; 0 0 -1 ];
wp(:,:,3) =[0 0 -1 ; 3 2 -1 ; 3 1 -1 ; 2 1 -1 ; 2 2 -1 ; 1 3 -1 ; 4 1 -1 ; 2 2 -1 ; 3 2 -1 ; 3 1 -1 ; 1 4 -1 ; 2 3 -1 ; 2 4 -1 ; 1 1 -1 ; 0 0 -1 ];
wp(:,:,4) =[0 0 -1 ; 1 2 -1 ; 3 2 -1 ; 2 4 -1 ; 3 4 -1 ; 2 1 -1 ; 4 1 -1 ; 4 2 -1 ; 3 3 -1 ; 3 4 -1 ; 4 1 -1 ; 2 3 -1 ; 2 1 -1 ; 4 2 -1 ; 0 0 -1 ];
wp(:,:,5) =[0 0 -1 ; 3 2 -1 ; 2 4 -1 ; 4 3 -1 ; 1 2 -1 ; 4 3 -1 ; 2 1 -1 ; 4 2 -1 ; 3 4 -1 ; 4 2 -1 ; 2 2 -1 ; 4 4 -1 ; 4 3 -1 ; 3 2 -1 ; 0 0 -1 ];
wp(:,:,6) =[0.0 0.0 -1 ; 1.899297 2.126924 -1 ; 2.293234 3.666122 -1 ; 2.718438 1.186296 -1 ; 1.891158 2.418284 -1 ; 2.109159 0.447516 -1 ; 1.412223 3.445168 -1 ; 0.763577 2.430979 -1 ; 3.140874 2.866344 -1 ; 1.256316 1.556048 -1 ; 3.231285 1.857067 -1 ; 2.176671 1.804412 -1 ; 2.903748 2.079716 -1 ; 1.128209 2.232893 -1 ; 0.0 0.0 -1 ];
wp(:,:,7) =[0.0 0.0 -1 ; 2.408154 2.177801 -1 ; 2.801798 1.212078 -1 ; 1.780339 2.827908 -1 ; 2.229739 2.387282 -1 ; 2.784391 1.362439 -1 ; 2.211399 2.098499 -1 ; 1.447138 0.770944 -1 ; 1.449616 3.486307 -1 ; 1.537168 3.989024 -1 ; -0.484662 1.850579 -1 ; 2.931787 3.183621 -1 ; 3.838698 2.706061 -1 ; 2.411068 1.391133 -1 ; 0.0 0.0 -1 ];
wp(:,:,8) =[0.0 0.0 -1 ; 3.618537 1.57986 -1 ; 1.110519 1.508894 -1 ; 2.307326 1.352917 -1 ; 2.360221 1.938896 -1 ; -0.044758 0.170113 -1 ; 1.664153 4.562244 -1 ; 3.143218 2.179245 -1 ; 1.740801 1.521325 -1 ; 3.258285 2.271605 -1 ; 2.369358 3.722259 -1 ; 0.457298 1.487524 -1 ; 2.397634 2.450242 -1 ; 0.569415 2.547317 -1 ; 0.0 0.0 -1 ];
wp(:,:,9) =[0.0 0.0 -1 ; 2.430988 3.259917 -1 ; 4.221695 1.930283 -1 ; 3.407117 0.729557 -1 ; 2.532414 5.534551 -1 ; 3.889374 4.651383 -1 ; 2.65325 3.109409 -1 ; 0.819784 4.847048 -1 ; 3.584878 2.444007 -1 ; 2.507199 3.282252 -1 ; 3.420703 3.381338 -1 ; 3.224265 2.882421 -1 ; 3.981876 2.454888 -1 ; 3.399409 2.704671 -1 ; 0.0 0.0 -1 ];
wp(:,:,10) =[0.0 0.0 -1 ; 3.132843 3.204147 -1 ; 3.762958 2.027575 -1 ; 3.022832 2.969648 -1 ; 0.853819 2.453511 -1 ; 4.465624 3.901417 -1 ; 2.300865 4.276465 -1 ; 2.427785 2.982134 -1 ; 2.287648 2.451153 -1 ; 1.828672 3.968097 -1 ; 1.883138 4.01993 -1 ; 3.124292 0.726769 -1 ; 2.10799 2.618989 -1 ; 3.985946 3.034011 -1 ; 0.0 0.0 -1 ];
wp(:,:,11) =[0.0 0.0 -1 ; 4.178029 3.006829 -1 ; 1.704563 2.272324 -1 ; 6.071531 6.197143 -1 ; 2.447873 4.510005 -1 ; 5.977068 1.309081 -1 ; 4.373338 7.871667 -1 ; 5.928521 2.418174 -1 ; 6.611435 5.586202 -1 ; 1.874522 7.042575 -1 ; 2.671104 3.089604 -1 ; 3.091172 2.737476 -1 ; 6.213012 7.325103 -1 ; 7.683956 2.112083 -1 ; 0.0 0.0 -1 ];
wp(:,:,12) =[0.0 0.0 -1 ; 4.932888 4.280239 -1 ; 7.742874 4.41546 -1 ; 5.549979 3.459612 -1 ; 4.587495 3.140476 -1 ; 8.035932 3.722575 -1 ; 0.455083 2.865298 -1 ; 3.772787 4.423344 -1 ; 1.944125 1.383023 -1 ; 7.610175 2.018781 -1 ; 3.169828 3.612549 -1 ; 6.473969 3.651551 -1 ; 5.979501 6.068341 -1 ; 3.079648 2.559262 -1 ; 0.0 0.0 -1 ];
wp(:,:,13) =[0.0 0.0 -1 ; 5.732392 4.105935 -1 ; 4.996138 3.925623 -1 ; 3.196827 4.716241 -1 ; 4.92343 1.342391 -1 ; 3.404705 2.856236 -1 ; 6.192029 3.970914 -1 ; 3.224645 4.254108 -1 ; 5.02151 3.674117 -1 ; 1.995781 5.376123 -1 ; 3.598444 3.459858 -1 ; 3.088047 3.938308 -1 ; 6.368939 3.670866 -1 ; 5.22835 6.403572 -1 ; 0.0 0.0 -1 ];
wp(:,:,14) =[0.0 0.0 -1 ; 2.401336 2.498793 -1 ; 6.060058 4.483334 -1 ; 3.588081 3.554267 -1 ; 3.505154 4.698977 -1 ; 3.777695 4.604795 -1 ; 4.397137 4.890647 -1 ; 2.738255 4.640792 -1 ; 3.270718 4.60844 -1 ; 2.878102 4.696468 -1 ; 3.600574 3.513242 -1 ; 2.974579 4.267049 -1 ; 4.163546 3.791487 -1 ; 4.570817 4.638585 -1 ; 0.0 0.0 -1 ];
wp(:,:,15) =[0 0 -1 ; 7 3 -1 ; 4 5 -1 ; 3 4 -1 ; 7 2 -1 ; 5 3 -1 ; 4 7 -1 ; 5 2 -1 ; 1 8 -1 ; 7 3 -1 ; 3 7 -1 ; 3 4 -1 ; 1 7 -1 ; 8 1 -1 ; 0 0 -1 ];
wp(:,:,16) =[0.0 0.0 -1 ; 2.353097 2.923954 -1 ; -0.396866 0.730147 -1 ; 2.37639 3.690352 -1 ; 1.086922 2.971958 -1 ; 3.722263 1.773886 -1 ; 1.055795 2.041697 -1 ; 2.018931 2.368204 -1 ; 1.77405 3.437646 -1 ; 1.31735 2.91196 -1 ; 1.648114 2.475058 -1 ; 1.641976 2.290493 -1 ; 0.708021 2.391463 -1 ; 0.154099 1.545788 -1 ; 0.0 0.0 -1 ];
wp(:,:,17) =[0.0 0.0 -1 ; 1.720588 2.091883 -1 ; 1.471197 1.594562 -1 ; 2.925941 2.37697 -1 ; 2.934212 0.202859 -1 ; 1.512846 1.149025 -1 ; 2.511067 0.713544 -1 ; 2.395162 2.09593 -1 ; 1.53046 1.065129 -1 ; 2.180378 3.334682 -1 ; 3.290663 3.301561 -1 ; 2.677207 2.211417 -1 ; 1.36969 4.003974 -1 ; 0.727705 2.171652 -1 ; 0.0 0.0 -1 ];
wp(:,:,18) =[0.0 0.0 -1 ; -0.115423 1.617297 -1 ; 2.273791 3.35273 -1 ; 2.113928 1.466865 -1 ; 1.180257 2.480195 -1 ; 1.457429 4.867218 -1 ; 1.957671 2.157343 -1 ; 1.609876 3.073386 -1 ; 2.249213 2.178588 -1 ; 2.8794 1.541258 -1 ; 1.902096 1.265259 -1 ; 1.198269 3.148174 -1 ; 0.17662 0.828022 -1 ; 1.663482 2.097718 -1 ; 0.0 0.0 -1 ];
wp(:,:,19) =[0.0 0.0 -1 ; 1.373983 2.343498 -1 ; 3.25247 2.099362 -1 ; 1.542507 2.349143 -1 ; 1.087627 4.014159 -1 ; 0.916978 2.227038 -1 ; 1.976264 3.954657 -1 ; 1.354316 2.515361 -1 ; 2.392368 2.714353 -1 ; 2.151061 2.512167 -1 ; 2.418394 0.835705 -1 ; 0.045605 3.409869 -1 ; 1.582991 2.334089 -1 ; 2.176688 1.357703 -1 ; 0.0 0.0 -1 ];
wp(:,:,20) =[0.0 0.0 -1 ; 3.590922 1.448726 -1 ; -0.503753 2.605096 -1 ; -0.084075 3.620988 -1 ; 1.686741 1.363654 -1 ; 4.135314 1.102952 -1 ; 4.514456 0.281091 -1 ; -1.567698 0.048827 -1 ; 0.279995 4.244697 -1 ; 5.665244 1.763064 -1 ; 4.24326 -2.407527 -1 ; 3.903583 -0.198672 -1 ; 2.391294 5.726058 -1 ; 3.156144 4.380763 -1 ; 0.0 0.0 -1 ];
wp(:,:,21) =[0.0 0.0 -1 ; 1.812326 3.734263 -1 ; 2.083488 1.625385 -1 ; 6.792392 0.095714 -1 ; 1.083547 -0.973024 -1 ; 2.065383 -0.440324 -1 ; 3.444333 2.702386 -1 ; -0.693764 4.491235 -1 ; 0.480793 -0.494909 -1 ; 3.381395 4.166987 -1 ; 3.902267 -0.676133 -1 ; 2.505661 1.780427 -1 ; 3.370497 1.025201 -1 ; 4.526966 1.534981 -1 ; 0.0 0.0 -1 ];
wp(:,:,22) =[0.0 0.0 -1 ; 5.325582 3.654675 -1 ; 4.890637 6.351104 -1 ; 3.384946 1.734606 -1 ; 1.698817 -0.523396 -1 ; 1.655798 1.310451 -1 ; 2.494378 0.770357 -1 ; 0.034766 -0.435022 -1 ; 3.173557 0.195704 -1 ; 1.433679 3.321288 -1 ; 2.194012 3.752616 -1 ; -0.906629 3.214282 -1 ; 3.342307 1.612972 -1 ; 1.53612 1.248238 -1 ; 0.0 0.0 -1 ];
wp(:,:,23) =[0.0 0.0 -1 ; 4.035485 2.133203 -1 ; 1.053901 3.075162 -1 ; 4.706459 0.430041 -1 ; 1.49171 0.122055 -1 ; 1.975274 1.109955 -1 ; 7.723367 -2.205853 -1 ; -0.586283 4.842301 -1 ; 3.912499 -1.525004 -1 ; 2.089747 2.085262 -1 ; -2.835697 4.600647 -1 ; 4.513343 2.638268 -1 ; 2.828181 1.244209 -1 ; 4.155307 1.966215 -1 ; 0.0 0.0 -1 ];
wp(:,:,24) =[0.0 0.0 -1 ; 1.966361 2.783322 -1 ; 4.358256 5.148182 -1 ; 2.798026 3.991691 -1 ; -1.057218 4.307002 -1 ; -0.227687 1.698088 -1 ; 0.437659 1.302169 -1 ; -1.399636 3.41129 -1 ; 2.444592 3.621381 -1 ; 4.38029 -0.520591 -1 ; 1.293709 4.832443 -1 ; 1.868841 -0.494197 -1 ; 0.867887 6.578117 -1 ; 1.037257 1.926349 -1 ; 0.0 0.0 -1 ];
wp(:,:,25) =[0.0 0.0 -1 ; 0.899391 2.197937 -1 ; 3.372431 3.04504 -1 ; 0.731394 -1.15253 -1 ; 6.749359 2.276391 -1 ; 2.672372 1.787278 -1 ; 1.437356 0.648983 -1 ; 3.314042 3.854904 -1 ; 2.093962 2.677374 -1 ; 1.768713 0.97396 -1 ; 1.210279 1.408352 -1 ; 1.520398 0.591113 -1 ; 2.092519 1.233185 -1 ; 5.389307 1.235259 -1 ; 0.0 0.0 -1 ];
wp(:,:,26) =[0.0 0.0 -1 ; 2.652813 5.488654 -1 ; 4.156533 1.856906 -1 ; 2.955351 -1.711882 -1 ; 2.970061 1.598641 -1 ; 0.696554 5.035531 -1 ; 2.488915 2.508967 -1 ; 5.163955 0.643634 -1 ; 2.376207 3.190432 -1 ; 1.684778 0.412701 -1 ; -0.11559 4.800899 -1 ; 1.267224 -0.405512 -1 ; 3.961317 1.962974 -1 ; 1.475372 4.93102 -1 ; 0.0 0.0 -1 ];
wp(:,:,27) =[0.0 0.0 -1 ; 3.539376 2.175169 -1 ; 1.28624 3.19729 -1 ; 0.458146 4.267245 -1 ; 0.477797 6.036819 -1 ; 4.688448 6.199965 -1 ; -0.045525 2.711998 -1 ; 6.063484 1.94516 -1 ; 3.170111 5.431971 -1 ; 0.875602 0.902821 -1 ; 2.554201 1.565569 -1 ; 0.7198 5.922861 -1 ; 5.697146 5.242573 -1 ; 2.499847 4.830779 -1 ; 0.0 0.0 -1 ];
wp(:,:,28) =[0.0 0.0 -1 ; -0.529749 3.466376 -1 ; 0.409721 1.205859 -1 ; 0.620349 1.840325 -1 ; 3.579096 1.915971 -1 ; 2.255431 -0.129754 -1 ; 0.417893 3.146452 -1 ; 3.800194 5.047842 -1 ; -0.012571 2.286852 -1 ; -0.961386 4.243357 -1 ; 5.684866 3.486337 -1 ; 4.593739 4.06489 -1 ; 3.352181 0.686966 -1 ; 4.793658 2.903888 -1 ; 0.0 0.0 -1 ];
wp(:,:,29) =[0.0 0.0 -1 ; 2.645646 2.161043 -1 ; -0.369564 3.212353 -1 ; 3.275795 1.653902 -1 ; 1.237785 3.968081 -1 ; 2.02106 3.210616 -1 ; 0.663631 1.17199 -1 ; 2.873848 3.957633 -1 ; 1.535567 2.071766 -1 ; 0.100372 4.45981 -1 ; -0.004786 2.978422 -1 ; 2.018387 2.954562 -1 ; 3.493744 -0.410762 -1 ; 1.620672 0.853143 -1 ; 0.0 0.0 -1 ];
wp(:,:,30) =[0.0 0.0 -1 ; 1.221291 2.767895 -1 ; 0.33887 1.695452 -1 ; -0.788802 2.789864 -1 ; 2.993382 0.806459 -1 ; 2.85958 1.662599 -1 ; 1.670497 1.729915 -1 ; 3.006936 6.105978 -1 ; 2.592059 3.766806 -1 ; -1.977646 1.910536 -1 ; 1.638906 0.981032 -1 ; 3.081237 -2.565238 -1 ; 3.335681 4.314842 -1 ; 4.477275 4.815456 -1 ; 0.0 0.0 -1 ];
wp(:,:,31) =[0.0 0.0 -1 ; 3.448928 2.571057 -1 ; 2.058277 3.36735 -1 ; 0.103673 5.483225 -1 ; 2.170619 5.832834 -1 ; 4.338494 2.026307 -1 ; 5.636998 2.022063 -1 ; 1.52035 2.366089 -1 ; 2.808934 2.663361 -1 ; 3.855782 2.173084 -1 ; 2.208236 1.85356 -1 ; 1.268941 0.433215 -1 ; 3.127848 3.406011 -1 ; 0.86631 -0.20553 -1 ; 0.0 0.0 -1 ];

% wp = [0 0 -1; 1.5 0 -1; 1.5 1.5 -1; 0 1.5 -1; 0 0 -1; 1.5 0 -1; 1.5 1.5 -1; 0 1.5 -1; 0 0 -1];
% wp(:,:,2) = [2 0 -1; 1.5 0 -1; 1.5 1.5 -1; 0 1.5 -1; 0 0 -1; 1.5 0 -1; 1.5 1.5 -1; 0 1.5 -1; 0 0 -1];



% Declare Global Valriables
    
numdimsA = ndims(wp);
% mdl = 'parrotMinidroneWaypointFollower'
noise_Seeds_original = Sensors.IMU.noiseSeeds;
count = 0.0;
init_count =0.0;

Fault_Dur = [0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5];
Phase_Delay = [0, 1, 2,3,4];
FaultVal = [3,4,5,6];
len_sim_each_wp = 1;
num_wp = 1;



for j = 1:num_wp  % Iteration for the waypoints 
    

    
    Sensors.IMU.noiseSeeds = noise_Seeds_original
    
    for i = 1:len_sim_each_wp
        
    waypoint = wp(:,:,j)
    Fault_Category = 1;  % Bias

    
    % Get and set fault values
    AccFI1 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI1/FIBlock');
    AccFI2 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI2/FIBlock');
    AccFI3 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI3/FIBlock');

    AccX_FI_Enable = AccFI1.Parameters(2);
    AccX_FI_FaultType = AccFI1.Parameters(3);
    AccX_FI_FaultValue = AccFI1.Parameters(4);
    AccX_FI_FaultEvent = AccFI1.Parameters(5);
    AccX_FI_EventValue = AccFI1.Parameters(6);
    AccX_FI_FaultEffect = AccFI1.Parameters(7);
    AccX_FI_EffectValue = AccFI1.Parameters(8);
                 
    
    AccX_FI_Enable.set('Value', 'on');

    AccX_FI_FaultType.set('Value', 'Bias/Offset');
    
    randomIndex_FaultValue = randi(length(FaultVal), 1)

    AccX_FI_FaultValue.set('Value', string(FaultVal(randomIndex_FaultValue)));
    
    AccX_FI_FaultEvent.set('Value', 'Deterministic');
    
    randomIndex_Phase_Delay = randi(length(Phase_Delay), 1)
    
    AccX_FI_EventValue.set('Value', string(Phase_Delay(randomIndex_Phase_Delay)));
    
    AccX_FI_FaultEffect.set('Value', 'Constant time');
    
    randomIndex_Fault_Dur = randi(length(Fault_Dur), 1)
    AccX_FI_EffectValue.set('Value', string(Fault_Dur(randomIndex_Fault_Dur)));

    
    
    
%     AccY_FI_Enable = AccFI2.Parameters(2);
%     AccY_FI_FaultType = AccFI2.Parameters(3);
%     AccY_FI_FaultValue = AccFI2.Parameters(4);
%     AccY_FI_FaultEvent = AccFI2.Parameters(5);
%     AccY_FI_EventValue = AccFI2.Parameters(6);
%     AccY_FI_FaultEffect = AccFI2.Parameters(7);
%     AccY_FI_EffectValue = AccFI2.Parameters(8);
%                  
%     
%     AccY_FI_Enable.set('Value', 'on');
% 
%     AccY_FI_FaultType.set('Value', 'Bias/Offset');
%     
% %     randomIndex_FaultValue = randi(length(FaultVal), 1)
% 
%     AccY_FI_FaultValue.set('Value', string(FaultVal(randomIndex_FaultValue)));    
%     
%     AccY_FI_FaultEvent.set('Value', 'Deterministic');
%     
% %     randomIndex_Phase_Delay = randi(length(Phase_Delay), 1);
%     AccY_FI_EventValue.set('Value', string(Phase_Delay(randomIndex_Phase_Delay)));
%     
%     AccY_FI_FaultEffect.set('Value', 'Constant time');
%     
% %     randomIndex_Fault_Dur = randi(length(Fault_Dur), 1)
%     AccY_FI_EffectValue.set('Value', string(Fault_Dur(randomIndex_Fault_Dur)));
% 
%     
    
    
%     AccZ_FI_Enable = AccFI3.Parameters(2);
%     AccZ_FI_FaultType = AccFI3.Parameters(3);
%     AccZ_FI_FaultValue = AccFI3.Parameters(4);
%     AccZ_FI_FaultEvent = AccFI3.Parameters(5);
%     AccZ_FI_EventValue = AccFI3.Parameters(6);
%     AccZ_FI_FaultEffect = AccFI3.Parameters(7);
%     AccZ_FI_EffectValue = AccFI3.Parameters(8);
%                  
%     
%     AccZ_FI_Enable.set('Value', 'on');
% 
%     AccZ_FI_FaultType.set('Value', 'Bias/Offset');
%     
%     AccZ_FI_FaultValue.set('Value', string(FaultVal(randomIndex_FaultValue)));    
%     
%     AccZ_FI_FaultEvent.set('Value', 'Deterministic');
%     
% %     randomIndex_Phase_Delay = randi(length(Phase_Delay), 1);
%     AccZ_FI_EventValue.set('Value', string(Phase_Delay(randomIndex_Phase_Delay)));
%     
%     AccZ_FI_FaultEffect.set('Value', 'Constant time');
%     
% %     randomIndex_Fault_Dur = randi(length(Fault_Dur), 1)
%     AccZ_FI_EffectValue.set('Value', string(Fault_Dur(randomIndex_Fault_Dur)));
% 
%     
%     noise_Seeds  = Sensors.IMU.noiseSeeds;
%     new_noise_Seeds = (noise_Seeds + ceil(noise_Seeds*0.05))
%     Sensors.IMU.noiseSeeds = new_noise_Seeds;
%        
    
    try
        sim('parrotMinidroneWaypointFollower.slx')
        sm = [ Acc.x.Data Acc.y.Data Acc.z.Data Gyro.Data altitude.Data MotorCmd.Data roll_pitch_yaw.Data ThurstRefOut.Data label.Data];
        ts_name = timeseries(sm,Acc.x.Time);
        ts_name = resample(ts_name,linspace(0,60,6000),'linear');
        filename = strcat(".\FaultyData\1_Offset\","Faulty_Simulation_wp_",int2str(j),"_Fault_Category_",int2str(Fault_Category),"_count_",int2str(i));
        save(filename,"ts_name",'-v7.3');
%         count = count + 1
    catch
        disp('ERROR')

        sm = [ Acc.x.Data Acc.y.Data Acc.z.Data Gyro.Data altitude.Data MotorCmd.Data roll_pitch_yaw.Data ThurstRefOut.Data label.Data];
        ts_name = timeseries(sm,Acc.x.Time);
        ts_name = resample(ts_name,linspace(0,60,6000),'linear');

        filename = strcat(".\FaultyData\1_Offset\Incomplete\","Faulty_Simulation_wp_",int2str(j),"_Fault_Category_",int2str(Fault_Category),"_count_",int2str(i));
        save(filename,"ts_name",'-v7.3');
%         count = count + 1
       
    end
    

       
     clear sm Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
     clear Sensors.IMU.noiseSeeds Fault_Category;
     clear AccFI1 AccFI2 AccFI3;
     clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;
    
    
    
    end
    
    clear sm Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
    clear Sensors.IMU.noiseSeeds Fault_Category;
    clear AccFI1 AccFI2 AccFI3;
    clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;
    
    
end


 clear sm Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
 clear Sensors.IMU.noiseSeeds Fault_Category ;
 clear AccFI1 AccFI2 AccFI3;
 clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;

    
for j = 1:num_wp
    
    
%     count = init_count;
    Sensors.IMU.noiseSeeds = noise_Seeds_original
    
   
    
    for k = 1:len_sim_each_wp
        
    waypoint = wp(:,:,j)
    Fault_Category = 2; % stuck at
    
    AccFI1 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI1/FIBlock');
    AccFI2 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI2/FIBlock');
    AccFI3 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI3/FIBlock');

    AccX_FI_Enable = AccFI1.Parameters(2);
    AccX_FI_FaultType = AccFI1.Parameters(3);
    AccX_FI_FaultValue = AccFI1.Parameters(4);
    AccX_FI_FaultEvent = AccFI1.Parameters(5);
    AccX_FI_EventValue = AccFI1.Parameters(6);
    AccX_FI_FaultEffect = AccFI1.Parameters(7);
    AccX_FI_EffectValue = AccFI1.Parameters(8);
                 
    
    AccX_FI_Enable.set('Value', 'on');

    AccX_FI_FaultType.set('Value', 'Stuck-at');
    
%     randomIndex_FaultValue = randi(length(FaultVal), 1)
% 
%     AccX_FI_FaultValue.set('Value', string(FaultVal(randomIndex_FaultValue)));
    
    AccX_FI_FaultEvent.set('Value', 'Deterministic');
    
    randomIndex_Phase_Delay = randi(length(Phase_Delay), 1)
    
    AccX_FI_EventValue.set('Value', string(Phase_Delay(randomIndex_Phase_Delay)));
    
    AccX_FI_FaultEffect.set('Value', 'Constant time');
    
    randomIndex_Fault_Dur = randi(length(Fault_Dur), 1)
    AccX_FI_EffectValue.set('Value', string(Fault_Dur(randomIndex_Fault_Dur)));
    
    try
        sim('parrotMinidroneWaypointFollower.slx')
        sm_stuckat = [ Acc.x.Data Acc.y.Data Acc.z.Data Gyro.Data altitude.Data MotorCmd.Data roll_pitch_yaw.Data ThurstRefOut.Data label.Data];
        ts_name_stuckat = timeseries(sm_stuckat,Acc.x.Time);
        ts_name_stuckat = resample(ts_name_stuckat,linspace(0,60,6000),'linear');

        filename = strcat(".\FaultyData\2_Stuck_at\","Faulty_Simulation_wp_",int2str(j),"_Fault_Category_",int2str(Fault_Category),"_count_",int2str(k));
        save(filename,"ts_name_stuckat",'-v7.3');
%         count = count + 1
        
    catch
        disp('ERROR')

        sm_stuckat = [ Acc.x.Data Acc.y.Data Acc.z.Data Gyro.Data altitude.Data MotorCmd.Data roll_pitch_yaw.Data ThurstRefOut.Data label.Data];
        ts_name_stuckat = timeseries(sm_stuckat,Acc.x.Time);
        ts_name_stuckat = resample(ts_name_stuckat,linspace(0,60,6000),'linear');

        filename = strcat(".\FaultyData\2_Stuck_at\Incomplete\","Faulty_Simulation_wp_",int2str(j),"_Fault_Category_",int2str(Fault_Category),"_count_",int2str(k));
        save(filename,"ts_name_stuckat",'-v7.3');
%         count = count + 1
        
    end
    
   
    clear sm_stuckat ts_name_stuckat Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
    clear Sensors.IMU.noiseSeeds Fault_Category ;
    clear AccFI1 AccFI2 AccFI3;
    clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;

    
    end
    
    clear sm_stuckat ts_name_stuckat Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
    clear Sensors.IMU.noiseSeeds Fault_Category ;
    clear AccFI1 AccFI2 AccFI3;
    clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;

    
 end
    
clear sm Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
clear Sensors.IMU.noiseSeeds Fault_Category ;
clear AccFI1 AccFI2 AccFI3;
clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;
  
    
 for j = 1:num_wp
    
    
%     count = init_count;
    Sensors.IMU.noiseSeeds = noise_Seeds_original;
    
    
       
    for l = 1:len_sim_each_wp
        
    waypoint = wp(:,:,j)
    Fault_Category = 3; % noise

    
    AccFI1 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI1/FIBlock');
    AccFI2 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI2/FIBlock');
    AccFI3 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI3/FIBlock');

    AccX_FI_Enable = AccFI1.Parameters(2);
    AccX_FI_FaultType = AccFI1.Parameters(3);
    AccX_FI_FaultValue = AccFI1.Parameters(4);
    AccX_FI_FaultEvent = AccFI1.Parameters(5);
    AccX_FI_EventValue = AccFI1.Parameters(6);
    AccX_FI_FaultEffect = AccFI1.Parameters(7);
    AccX_FI_EffectValue = AccFI1.Parameters(8);
                 
    
    AccX_FI_Enable.set('Value', 'on');

    AccX_FI_FaultType.set('Value', 'Noise');
    
%     randomIndex_FaultValue = randi(length(FaultVal), 1)
% 
    AccX_FI_FaultValue.set('Value', '100');
    
    AccX_FI_FaultEvent.set('Value', 'Deterministic');
    
    randomIndex_Phase_Delay = randi(length(Phase_Delay), 1)
    
    AccX_FI_EventValue.set('Value', string(Phase_Delay(randomIndex_Phase_Delay)));
    
    AccX_FI_FaultEffect.set('Value', 'Constant time');
    
    randomIndex_Fault_Dur = randi(length(Fault_Dur), 1)
    AccX_FI_EffectValue.set('Value', string(Fault_Dur(randomIndex_Fault_Dur)));

         
    
    try
        sim('parrotMinidroneWaypointFollower.slx');
        sm_noise = [ Acc.x.Data Acc.y.Data Acc.z.Data Gyro.Data altitude.Data MotorCmd.Data roll_pitch_yaw.Data ThurstRefOut.Data label.Data];
        ts_name_noise = timeseries(sm_noise,Acc.x.Time);
        ts_name_noise = resample(ts_name_noise,linspace(0,60,6000),'linear');

        filename = strcat(".\FaultyData\3_Noise\","Faulty_Simulation_wp_",int2str(j),"_Fault_Category_",int2str(Fault_Category),"_count_",int2str(l));
        save(filename,"ts_name_noise",'-v7.3');
%         count = count + 1
        
    catch
        disp('ERROR')

        sm_noise = [ Acc.x.Data Acc.y.Data Acc.z.Data Gyro.Data altitude.Data MotorCmd.Data roll_pitch_yaw.Data ThurstRefOut.Data label.Data];
        ts_name_noise = timeseries(sm_noise,Acc.x.Time);
        ts_name_noise = resample(ts_name_noise,linspace(0,60,6000),'linear');

        filename = strcat(".\FaultyData\3_Noise\Incomplete\","Faulty_Simulation_wp_",int2str(j),"_Fault_Category_",int2str(Fault_Category),"_count_",int2str(l));
        save(filename,"ts_name_noise",'-v7.3');
%         count = count + 1
        
    end
    

    clear sm_noise ts_name_noise Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
    clear Sensors.IMU.noiseSeeds Fault_Category ;
    clear AccFI1 AccFI2 AccFI3;
    clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;

    
    end
    clear sm_noise ts_name_noise Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
    clear Sensors.IMU.noiseSeeds Fault_Category ;
    clear AccFI1 AccFI2 AccFI3;
    clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;

   
    
 end
    
clear sm Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
clear Sensors.IMU.noiseSeeds Fault_Category ;
clear AccFI1 AccFI2 AccFI3;
clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;
   
    
 for j = 1:num_wp
    
    
%     count = init_count;
    
    
       
    for m = 1:len_sim_each_wp
        
    Fault_Category = 4; % package drop
    waypoint = wp(:,:,j)

    
    AccFI1 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI1/FIBlock');
    AccFI2 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI2/FIBlock');
    AccFI3 = Simulink.Mask.get('parrotMinidroneWaypointFollower/Sensors Model/Sensors (Dynamics)/Sensor System/IMU_Pressure/HAL_acquisition_creator/Acc Fault Injector/AccFI3/FIBlock');

    AccX_FI_Enable = AccFI1.Parameters(2);
    AccX_FI_FaultType = AccFI1.Parameters(3);
    AccX_FI_FaultValue = AccFI1.Parameters(4);
    AccX_FI_FaultEvent = AccFI1.Parameters(5);
    AccX_FI_EventValue = AccFI1.Parameters(6);
    AccX_FI_FaultEffect = AccFI1.Parameters(7);
    AccX_FI_EffectValue = AccFI1.Parameters(8);
                 
    
    AccX_FI_Enable.set('Value', 'on');

    AccX_FI_FaultType.set('Value', 'Package drop');
    
%     randomIndex_FaultValue = randi(length(FaultVal), 1)
% 
    AccX_FI_FaultValue.set('Value', '15');
    
    AccX_FI_FaultEvent.set('Value', 'Deterministic');
    
    randomIndex_Phase_Delay = randi(length(Phase_Delay), 1)
    
    AccX_FI_EventValue.set('Value', string(Phase_Delay(randomIndex_Phase_Delay)));
    
    AccX_FI_FaultEffect.set('Value', 'Constant time');
    
    randomIndex_Fault_Dur = randi(length(Fault_Dur), 1)
    AccX_FI_EffectValue.set('Value', string(Fault_Dur(randomIndex_Fault_Dur)));

             
    try
        sim('parrotMinidroneWaypointFollower.slx')
        sm_pd = [ Acc.x.Data Acc.y.Data Acc.z.Data Gyro.Data altitude.Data MotorCmd.Data roll_pitch_yaw.Data ThurstRefOut.Data label.Data];
        ts_name_pd = timeseries(sm_pd,Acc.x.Time);
        ts_name_pd = resample(ts_name_pd,linspace(0,60,6000),'linear');

        filename = strcat(".\FaultyData\4_Package_Drop\","Faulty_Simulation_wp_",int2str(j),"_Fault_Category_",int2str(Fault_Category),"_count_",int2str(m));
        save(filename,"ts_name_pd",'-v7.3');
%         count = count + 1
        
    catch
        disp('ERROR')

        sm_pd = [ Acc.x.Data Acc.y.Data Acc.z.Data Gyro.Data altitude.Data MotorCmd.Data roll_pitch_yaw.Data ThurstRefOut.Data label.Data];
        ts_name_pd = timeseries(sm_pd,Acc.x.Time);
        ts_name_pd = resample(ts_name_pd,linspace(0,60,6000),'linear');

        filename = strcat(".\FaultyData\4_Package_Drop\Incomplete\","Faulty_Simulation_wp_",int2str(j),"_Fault_Category_",int2str(Fault_Category),"_count_",int2str(m));
        save(filename,"ts_name_pd",'-v7.3');
%         count = count + 1
        
    end
    
  
    clear sm_pd ts_name_pd Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
    clear Sensors.IMU.noiseSeeds Fault_Category ;
    clear AccFI1 AccFI2 AccFI3;
    clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;

    
    end
       
    clear sm_noise ts_name_noise Acc Gyro altitude MotorCmd roll_pitch_yaw ThurstRefOut label;
    clear Sensors.IMU.noiseSeeds Fault_Category ;
    clear AccFI1 AccFI2 AccFI3;
    clear AccX_FI_Enable AccX_FI_FaultType AccX_FI_FaultValue AccX_FI_EventValue AccX_FI_FaultEvent AccX_FI_FaultEffect AccX_FI_EffectValue;
  
end


